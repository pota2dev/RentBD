generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "rhel-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DIRECT_URL")
}

model Availability {
  id            String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  propertyId    String   @db.Uuid
  startDate     DateTime @db.Date
  endDate       DateTime @db.Date
  isAvailable   Boolean  @default(true)
  priceOverride Decimal?
  Property      Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
}

model Booking {
  id              String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  propertyId      String        @db.Uuid
  tenantId        String
  checkInDate     DateTime      @db.Date
  checkOutDate    DateTime      @db.Date
  numberOfGuests  Int?
  totalPrice      Decimal
  status          BookingStatus @default(PENDING)
  specialRequests String?
  requestedAt     DateTime      @default(now())
  respondedAt     DateTime?
  Property        Property      @relation(fields: [propertyId], references: [id])
  Tenant          Tenant        @relation(fields: [tenantId], references: [id])
  Message         Message[]
  Payment         Payment[]
  Review          Review?
}

model EmailLog {
  id        String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId    String?
  type      String
  recipient String
  subject   String?
  body      String?
  status    String?
  sentAt    DateTime @default(now())
  User      User?    @relation(fields: [userId], references: [id])
}

model Landlord {
  id            String     @id
  bio           String?
  businessName  String?
  taxId         String?
  totalEarnings Float      @default(0.0)
  averageRating Float      @default(0.0)
  User          User       @relation(fields: [id], references: [id], onDelete: Cascade)
  Property      Property[]
}

model Message {
  id                            String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  senderId                      String
  receiverId                    String
  bookingId                     String?  @db.Uuid
  messageText                   String
  isRead                        Boolean  @default(false)
  sentAt                        DateTime @default(now())
  Booking                       Booking? @relation(fields: [bookingId], references: [id])
  User_Message_receiverIdToUser User     @relation("Message_receiverIdToUser", fields: [receiverId], references: [id])
  User_Message_senderIdToUser   User     @relation("Message_senderIdToUser", fields: [senderId], references: [id])
}

model Notification {
  id              String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  userId          String
  type            String
  title           String?
  message         String?
  isRead          Boolean  @default(false)
  relatedEntityId String?
  createdAt       DateTime @default(now())
  User            User     @relation(fields: [userId], references: [id])
}

model Payment {
  id              String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  bookingId       String        @db.Uuid
  amount          Decimal
  status          PaymentStatus @default(PENDING)
  method          String?
  transactionId   String?       @unique
  processedAt     DateTime?
  gatewayResponse String?
  Booking         Booking       @relation(fields: [bookingId], references: [id])
}

model Property {
  id                String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  landlordId        String
  title             String
  description       String?
  type              PropertyType
  address           String
  city              String
  state             String?
  zipCode           String?
  latitude          Float?
  longitude         Float?
  bedrooms          Int?
  bathrooms         Int?
  area              Float?
  pricePerMonth     Decimal?
  maxGuests         Int?
  status            PropertyStatus    @default(DRAFT)
  averageRating     Float             @default(0.0)
  totalReviews      Int               @default(0)
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt
  balcony           Int               @default(0)
  district          String?
  division          String?
  floorNo           Int?
  shortAddress      String?
  subArea           String?
  thana             String?
  utilitiesIncluded String?
  Availability      Availability[]
  Booking           Booking[]
  Landlord          Landlord          @relation(fields: [landlordId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  PropertyAmenity   PropertyAmenity[]
  PropertyImage     PropertyImage[]
  PropertyRule      PropertyRule[]
  Review            Review[]
  SavedProperty     SavedProperty[]
}

model PropertyAmenity {
  id          String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  propertyId  String   @db.Uuid
  amenityName String
  amenityType String?
  Property    Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
}

model PropertyImage {
  id           String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  propertyId   String   @db.Uuid
  imageUrl     String
  thumbnailUrl String?
  displayOrder Int?
  isPrimary    Boolean  @default(false)
  uploadedAt   DateTime @default(now())
  Property     Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
}

model PropertyRule {
  id         String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  propertyId String   @db.Uuid
  ruleText   String
  ruleType   String?
  Property   Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
}

model Report {
  id          String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  reporterId  String
  type        ReportType
  targetId    String
  reason      String?
  description String?
  status      String     @default("PENDING")
  createdAt   DateTime   @default(now())
  User        User       @relation(fields: [reporterId], references: [id])
}

model Review {
  id         String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  propertyId String   @db.Uuid
  tenantId   String
  bookingId  String   @unique @db.Uuid
  rating     Int
  reviewText String?
  createdAt  DateTime @default(now())
  Booking    Booking  @relation(fields: [bookingId], references: [id])
  Property   Property @relation(fields: [propertyId], references: [id])
  Tenant     Tenant   @relation(fields: [tenantId], references: [id])
}

model SavedProperty {
  id         String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  tenantId   String
  propertyId String   @db.Uuid
  savedAt    DateTime @default(now())
  Property   Property @relation(fields: [propertyId], references: [id])
  Tenant     Tenant   @relation(fields: [tenantId], references: [id])

  @@unique([tenantId, propertyId])
}

model Tenant {
  id                       String          @id
  bio                      String?
  occupation               String?
  numberOfPreviousBookings Int             @default(0)
  averageRating            Float           @default(0.0)
  Booking                  Booking[]
  Review                   Review[]
  SavedProperty            SavedProperty[]
  User                     User            @relation(fields: [id], references: [id], onDelete: Cascade)
}

model User {
  id                               String             @id @default(uuid())
  supabaseAuthId                   String             @unique
  email                            String             @unique
  firstName                        String?
  lastName                         String?
  phoneNumber                      String?
  profilePicture                   String?
  role                             UserRole           @default(TENANT)
  verificationStatus               VerificationStatus @default(UNVERIFIED)
  isActive                         Boolean            @default(true)
  isBanned                         Boolean            @default(false)
  createdAt                        DateTime           @default(now())
  lastLogin                        DateTime?
  EmailLog                         EmailLog[]
  Landlord                         Landlord?
  Message_Message_receiverIdToUser Message[]          @relation("Message_receiverIdToUser")
  Message_Message_senderIdToUser   Message[]          @relation("Message_senderIdToUser")
  Notification                     Notification[]
  Report                           Report[]
  Tenant                           Tenant?
}

enum AuthType {
  PASSWORD
  TWO_FACTOR
  PASSKEY
  GOOGLE
  GITHUB
}

enum BookingStatus {
  PENDING
  ACCEPTED
  REJECTED
  CONFIRMED
  CANCELLED
  COMPLETED
}

enum PaymentStatus {
  PENDING
  COMPLETED
  FAILED
  REFUNDED
}

enum PropertyStatus {
  DRAFT
  PENDING_APPROVAL
  ACTIVE
  INACTIVE
  REJECTED
}

enum PropertyType {
  APARTMENT
  HOUSE
  CONDO
  STUDIO
  ROOM
}

enum ReportType {
  PROPERTY
  USER
  REVIEW
  OTHER
}

enum UserRole {
  TENANT
  LANDLORD
  ADMIN
}

enum VerificationStatus {
  UNVERIFIED
  PENDING
  VERIFIED
}
